name: Auto Label Discussions by Category

on:
  discussion:
    types: [created]

jobs:
  add_label_based_on_category:
    runs-on: ubuntu-latest

    steps:
      - name: Check discussion category and add label
        env:
          GITHUB_TOKEN: ${{ secrets.G_TOKEN }}  # Make sure your token has proper permissions
        run: |
          CATEGORY_NAME=$(echo "${{ github.event.discussion.category.name }}" | tr '[:upper:]' '[:lower:]')

          if [[ "$CATEGORY_NAME" == "jira" ]]; then
            LABEL="Jira"
          elif [[ "$CATEGORY_NAME" == "servicenow" ]]; then
            LABEL="ServiceNow"
          elif [[ "$CATEGORY_NAME" == "fusion friday" ]]; then
            LABEL="FusionFriday"
          elif [[ "$CATEGORY_NAME" == "q&a" ]]; then
            LABEL="CloudOperations"
          else
            echo "No matching category found. No label will be added."
            exit 0
          fi

          # Add the label to the discussion using GitHub Discussions API
          curl -X POST \
            -H "Authorization: Bearer $GITHUB_TOKEN" \
            -H "Accept: application/vnd.github.v3+json" \
            https://api.github.com/repos/${{ github.repository }}/discussions/${{ github.event.discussion.id }}/labels \
            -d "{\"labels\":[\"$LABEL\"]}"
