name: Auto-Assign Labels to Discussions Based on Category

on:
  discussions:
    types: [created]

jobs:
  assign-label:
    runs-on: ubuntu-latest
    steps:
      - name: Check out the repo
        uses: actions/checkout@v3

      - name: Install GitHub CLI
        run: |
          sudo apt-get install gh -y

      - name: Assign Label based on Category
        env:
          GITHUB_TOKEN: ${{ secrets.G_TOKEN }}
        run: |
          CATEGORY="${{ github.event.discussion.category.name }}"

          if [[ "$CATEGORY" == "Fusion Friday" ]]; then
            LABEL="FusionFriday"
          elif [[ "$CATEGORY" == "Q&A" ]]; then
            LABEL="CloudOperations"
          elif [[ "$CATEGORY" == "Ideas" ]]; then
            LABEL="Ideas"
          elif [[ "$CATEGORY" == "Channels" ]]; then
            LABEL="Channels"
          # Add more categories and corresponding labels as needed

          echo "Assigning label: $LABEL"

          # Apply the label to the discussion
          gh api \
            -X POST \
            -H "Authorization: token $GITHUB_TOKEN" \
            -H "Accept: application/vnd.github.v3+json" \
            /repos/${{ github.repository }}/issues/${{ github.event.discussion.number }}/labels \
            -d '{"labels":["'"$LABEL"'"]}'
